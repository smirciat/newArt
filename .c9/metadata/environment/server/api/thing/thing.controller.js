{"filter":false,"title":"thing.controller.js","tooltip":"/server/api/thing/thing.controller.js","undoManager":{"mark":7,"position":7,"stack":[[{"start":{"row":15,"column":0},"end":{"row":15,"column":1},"action":"insert","lines":["/"],"id":2},{"start":{"row":15,"column":1},"end":{"row":15,"column":2},"action":"insert","lines":["/"]}],[{"start":{"row":16,"column":0},"end":{"row":16,"column":1},"action":"insert","lines":["/"],"id":3},{"start":{"row":16,"column":1},"end":{"row":16,"column":2},"action":"insert","lines":["/"]}],[{"start":{"row":18,"column":0},"end":{"row":18,"column":1},"action":"insert","lines":["/"],"id":4},{"start":{"row":18,"column":1},"end":{"row":18,"column":2},"action":"insert","lines":["/"]}],[{"start":{"row":19,"column":2},"end":{"row":19,"column":3},"action":"insert","lines":["/"],"id":5},{"start":{"row":19,"column":3},"end":{"row":19,"column":4},"action":"insert","lines":["/"]}],[{"start":{"row":20,"column":0},"end":{"row":20,"column":1},"action":"insert","lines":["/"],"id":6},{"start":{"row":20,"column":1},"end":{"row":20,"column":2},"action":"insert","lines":["/"]}],[{"start":{"row":21,"column":0},"end":{"row":21,"column":1},"action":"insert","lines":["/"],"id":7},{"start":{"row":21,"column":1},"end":{"row":21,"column":2},"action":"insert","lines":["/"]}],[{"start":{"row":128,"column":0},"end":{"row":258,"column":1},"action":"remove","lines":["async function createDocument(collection,object,uniqueId){","  const docRef = firebase_db.collection(collection).doc(uniqueId);//need this to be unique and readable from TF","","   docRef.set(object)","   .then(() => {","     console.log('Document created successfully!');","   })","   .catch((error) => {","     console.error('Error creating document:', error);","   });","}","","export async function pax(req,res){","  try { ","    let file=req.body.file||\"pax.csv\";","    let data=fs.readFileSync(__dirname+'/../../../../fraBering/server/fileserver/'+file, 'utf-8');//get rid of 2 levels if moving to fraBering","    let stats=fs.statSync(__dirname+'/../../../../fraBering/server/fileserver/'+file, 'utf-8');","    let arr=data.split('\\r\\n');","    let paxArrLength=arr.length;","    let a=arr[1].split(' ');","    a.splice(0,2);","    a.splice(-4);","    let daily={","      reportDate:new Date(a.join(' ')),","      reportDateString:new Date(a.join(' ')).toLocaleDateString()","    };","    a=arr[5].split(' ');","    a.splice(0,2);","    a[a.length-1]=a[a.length-1].substring(0,2);","    daily.reportTimestamp=new Date(a.join(' '));","    console.log(daily.reportTimestamp);","    let uniqueId=daily.reportDateString.split('/').join('_');","    arr.splice(0,9);","    let p=[];","    arr.forEach((a,index)=>{","      let t=a.split(',');","      if (!t[0]&&!t[1]) return;","      if (!t[6]||!t[7]||!t[11]) {","        p.push({remove:true});","        return;","      }","      let _id=t[9]+'~'+t[6].split(' ').join('_')+'~'+t[7].split(' ').join('_')+'~'+t[11].split(' ').join('_');","      let paxWeight=0;","      let bagWeight=0;","      if (t[18]&&!isNaN(t[18])) paxWeight=t[18]*1;","      if (t[19]&&!isNaN(t[19])) bagWeight=t[19]*1;","      let multiple=1;","      if (false){//index>0) {","        if (_id===p[index-1]._id) {","          let i=index-1;","          do {","            if (_id===p[i]._id){","              multiple++;","              p[i].remove=true;","              paxWeight=paxWeight*1+p[i].paxWeight*1;","              bagWeight=bagWeight*1+p[i].bagWeight*1;","              i--;","            }","          } while (_id===p[i]._id);","          console.log(paxWeight);","        }","      }","      let obj={","        dateString:daily.reportDateString,","        departTime:t[0],","        flightId:t[1],","        flightNum:t[2],","        aircraft:t[4],","        from:t[6],","        to:t[7],","        bookingNum:t[9],","        name:t[11],","        status:t[15],","        paxWeight:paxWeight,","        bagWeight:bagWeight,","        remove:false","      };","      p.push(obj);","      //console.log(temp);","    });","    p=p.filter(e=>{return !e.remove});","    daily.pax=p;","    daily.frt=await frt(paxArrLength,daily.reportDateString);","    if (new Date(timestamp).toLocaleString()!==new Date(daily.reportTimestamp).toLocaleString()) await createDocument('passengers',daily,uniqueId);","    else console.log('Nothing to update, try again next time');","    timestamp=daily.reportTimestamp;","    res.status(200).json('successfully imported pax.csv & frt.csv');","  }","  catch(err){","    console.log(err);","    res.status(404).json('error processing pax & frt');","  }","}","","async function frt(paxArrLength,reportDateString){","  let file=\"frt.csv\";","  let data=fs.readFileSync(__dirname+'/../../../../fraBering/server/fileserver/'+file, 'utf-8');//get rid of 2 levels if moving to fraBering","  let arr=data.split('\\r\\n');","  let f=[];","  if (arr.length===paxArrLength) return f;","  arr.splice(0,8);","  let title=arr.shift();","  title=title.split(',');","  if (title&&title.length>0&&title[0]!=='Freight') return f; ","  arr.forEach((a,index)=>{","    let t=a.split(',');","    if (!t[0]&&!t[1]) return;","    if (!t[6]||!t[7]||!t[11]) return;","    let paxWeight=0;","    let bagWeight=0;","    if (t[18]&&!isNaN(t[18])) paxWeight=t[18]*1;","    if (t[19]&&!isNaN(t[19])) bagWeight=t[19]*1;","    let obj={","      dateString:reportDateString,","      departTime:t[0],","      flightId:t[1],","      flightNum:t[2],","      aircraft:t[4],","      from:t[6],","      to:t[7],","      bookingNum:t[9],","      name:t[11],","      status:t[15],","      paxWeight:paxWeight,","      bagWeight:bagWeight,","      remove:false","    };","    f.push(obj);","  });","  return f;","}"],"id":8}],[{"start":{"row":21,"column":40},"end":{"row":22,"column":14},"action":"remove","lines":["","let timestamp;"],"id":9}]]},"ace":{"folds":[],"scrolltop":2001.3959971038648,"scrollleft":0,"selection":{"start":{"row":21,"column":40},"end":{"row":21,"column":40},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":116,"state":"start","mode":"ace/mode/javascript"}},"timestamp":1747328699416,"hash":"83221f32101cbe12e58033157c2dd6aeef59a14f"}